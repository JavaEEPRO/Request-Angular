<!DOCTYPE html>
<html lang="en" ng-app = "requestApp">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--    stylesheets :   -->
    <!--  bootstrap styles    -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"/><!--https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/-->
    <!--  font awesome styles -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <title>Request AngularJS</title>
</head>
<body>

<div ng-controller = "requestHandlerController as requestHandler" >
    <!--<h2>Welcome {{helloTo.title}} to the world of Tutorialspoint!</h2>-->
    <!--<h1>Messages Out</h1>-->
    <!--<ul>-->
        <!--<li ng-repeat="request in dataTable">{{request.name}}</li>-->
    <!--</ul>-->

<table class="table table-striped">

    <tbody>
    <tr ng-repeat="request in dataTable" class="data-row" ng-class="{reverse: reverse}">

        <td>
            <img class="ava-img ava-displayed" ng-src="{{request.avatarSrc}}"  alt="user ava">
        </td>
        <td class="name-phone-col">
            <div class="name-container">
                {{request.name}}
            </div>
            <div class="phone-container">
                {{request.phone}}
            </div>

        </td>
        <td class="message-col">
            <div class="message-container">
                {{request.message}}
            </div>
        </td>

        <td class="attachments-col">
            <div ng-attr-id="{{ 'attachments-container-' + request.index }}"></div>
        </td>

    </tr>
    </tbody>
</table>

<div class="controls-container container">
    <form>
        
        <div class="ava-chooser">
            <div class="block-of-chooser">
                <input type="checkbox" class="check-box-ava d">
                <div class="ava-example-container">
                    <img class="ava-img" src="img/smithd.jpg" alt="click example to choose">
                </div>
            </div>
            <div class="block-of-chooser">
                <input type="checkbox" class="check-box-ava b">
                <div class="ava-example-container">
                    <img class="ava-img" src="img/smithb.jpg" alt="click example to choose">
                </div>
            </div>
            <div class="block-of-chooser">
                <input type="checkbox" class="check-box-ava default-ava" checked>
                <div class="ava-example-container">
                    <img class="ava-img" src="img/smithc.jpg"  alt="click example to choose">
                </div>
            </div>
        </div>
        
        
        <div class="row controls-row">
            <div class="col-sm-4 container text-inputs-container">
                <div class="row inputs-container">
                    <div class="col-sm-3 text-input-container container">
                        <input id="name" type="text"  ng-model="nextRequest.name" placeholder="type name...">
                    </div>

                    <div class="col-sm-3 text-input-container container">
                        <input id="phone" type="text"  ng-model="nextRequest.phone" placeholder="type phone...">
                    </div>
                </div>

                <br>

                <div class="col-sm-12 text-input-container container">
                    <textarea id="message" placeholder="type message..." class="message-area" ng-model="nextRequest.message"></textarea>
                </div>
            </div>

            <div id="drop-area" class="col-sm-4">
                <div class="my-form">

                    <p class="drop-area-title">Load images using the file selection dialog or dragging the desired images into the selected area</p>
                    <input type="file" ng-model="content" id="fileElem" accept="image/*" multiple onchange="handleFiles(this.files)">
                    <div class="container clear-drop-zone">
                        <div class="row">
                            <label id="choose-drop-zone-btn" class="btn btn-block btn-primary col-sm-10" for="fileElem">Select Images To Accept</label>
                            <label id="clear-drop-zone-btn" class="btn btn-block btn-outline-danger col-sm-2">
                                <i class="fas fa-recycle customized-recycle"></i>
                                <i class="fas fa-trash customized-bin"></i>
                                <i class="fas fa-broom customized-broom"></i>
                            </label>
                        </div>
                    </div>
                </div>
                <progress id="progress-bar" class="progress-bar" max=100 value=0><span>progress</span><span id="span-progressive-1">100%</span></progress>
                <div id="gallery"></div>
            </div>

            <div class="col-sm-2">
                <label id="send-button" class="btn btn-block btn-outline-danger"><i class="fa fa-plane custom-plane" aria-hidden="true"></i><div id="send-lbl">Send</div></label>
            </div>
        </div>

    </form>
</div>


</div><!--controller-->



</body>
<!--  custom styles  -->
<style>
    .attachments-col {
        width:15em;
        background-color: blue;
    }
    .name-phone-col{
        max-width: 13em;
    }
    .message-col {
        background-color: lightgray;
        width: 35em;
    }
    .name-container{
        background-color: blue;
        transform: translateX(3em) translateY(1em) scale(1.5);
        max-width: 8em;
        align-content: center;
        text-align: center;
    }
    .phone-container{
        transform: translateX(10em) scale(1.3) translateY(2em);
    }
    .message-container{

    }

    .data-row {
        margin: 4em;
        height: 8em;
    }
    .check-box-ava {
        opacity: 0.9;
    }
    .ava-img {
        height: 2.5em;
        width: 2.5em;
        border-radius: 1.5em;
        position: absolute;
        transform: translateY(-2.1em) translateX(-2.5em);
        z-index: -1;
    }
    .ava-displayed {
        transform: translateY(1.9em) translateX(2em) scale(3);
    }
    .ava-chooser {
        width: 1em;
        position: absolute;
        margin: 5em 2em 2em;
        padding: 1em;
        transform: scale(2);
    }
    .block-of-chooser {
        width: 3em;
        transform: translateX(-3em);
        margin: 1.1em;
    }
    .custom-plane {
        transform: translateX(1em) translateY(2.7em) scale(7) rotate(-42deg);
    }
    #send-button{
        height: 11em;
        width: 11em;
        border-radius: 17px;
        margin: 4em;
        transform: scale(1.2);
    }
    #send-button:hover{
        transform: scale(1.22);
        animation: ease-in 3s;
    }
    #send-lbl{
        transform: translateY(5.4em) translateX(0.1em) scale(3);
    }
    .controls-container {
        position: fixed;
        bottom: 0.3em;
        left: 5%;
        width: 95%;
    }
    .controls-row {
        height: 21em;
    }
    .inputs-container {

        width: 111%;
    }
    .text-inputs-container {
        transform: translateY(3em);
    }
    .message-area {
        width: 23.5em;
        height: 11em;
        margin: -1em 3em 2em 2em;
        border-bottom-left-radius: 17px;
        border-bottom-right-radius: 17px;
        text-align: center;

    }
    #name{
        border-top-left-radius: 17px;
        text-align: center;
    }
    #phone{
        border-top-right-radius: 17px;
        text-align: center;
    }
    input[placeholder], textarea[placeholder] {
        color: darkviolet;
        text-overflow:ellipsis;
        text-indent: 0px;   transition: text-indent 0.3s ease;
    }
    input:focus::placeholder {
        text-indent: 500px; transition: text-indent 0.3s ease;
    }
    textarea:focus::placeholder {
        text-indent: -500px; transition: text-indent 0.3s ease;
    }
    /* files uploader styles */
    #drop-area {
        border: 7px dashed #007bff;
        border-radius: 50px;
        width: 375px;
        font-family: sans-serif;
        margin-top:  -1.1em;
        margin-left: 2.4em;
        padding: 20px;
        transform: scale(0.6);
    }
    #drop-area.highlight {
        border-color: purple;
    }
    .move-up {
        transform: translateY(-1em) scale(0.6) !important;

    }
    .hidden {
        visibility: hidden;
    }
    p {
        margin-top: 0;
    }
    .my-form {
        margin-bottom: 10px;
    }
    #gallery {
        margin-top: 10px;
    }
    #gallery img {
        width: 150px;
        margin-bottom: 10px;
        margin-right: 10px;
        vertical-align: middle;
    }
    .uplButton {
        display: inline-block;
        padding: 10px;
        background: #ccc;
        cursor: pointer;
        border-radius: 5px;
        border: 1px solid #ccc;
    }
    .uplButton:hover {
        background: #ddd;
    }
    #fileElem {
        display: none;
    }

    /*progress bar*/
    /**/
    .progress-bar{
        height:7px;
        line-height:40px;
        width:320px;
        position:relative;
        text-align:center;
        color:black;
    }
    .progress-bar span{
        position:absolute;
        top:0;
        left:0;
        width:100%;
        background-color:gray;
    }
    .grey {
        background-color: grey;
        color: grey;
    }
    .progress-bar span:last-child{
        background-color:green;
        color:white;
        clip:rect(0 0px 40px 0);
    }
    .drop-area-title {
        text-align: center;
        font-style: italic;

        color: #007bff;
    }
    .customized-recycle {
        color: white;
        position: absolute;
        z-index: 2;
        transform: translateY(0.4em) translateX(-0.05em);
    }
    .customized-bin {
        transform: scale(2.1);
        z-index: -2;
    }
    .customized-broom {
        color: red;
        position: absolute;
        transform: translateY(0.7em) scale(1.5);
        opacity: 0.7;
    }
    .clear-drop-zone {
        /*position: center;*/
    }
    #clear-drop-zone-btn {
        /*height: 4em;*/
        opacity: 0.7;
        padding: 11px;
    }
    #choose-drop-zone-btn {
        margin-top: 0.44em;
        padding-top: 0.7em;
    }
    .red {
        color:red !important;
        opacity:0.8;
    }
    .disabled {
        pointer-events: none;
        color: grey !important;
    }
    .hide {
        display: none !important;
    }
</style>

<!-- jQuery -->
<script
        src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
        crossorigin="anonymous"></script>
<!-- popper -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<!-- bootstrap -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<!-- angular -->
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.8/angular.min.js"></script>

<!-- custom scripts -->

<!-- img uploader -->
<script>
    $(document).ready(function () {
        $('#clear-drop-zone-btn').on('click', function () {
            clearDropZone(gallery);
        });
    });

    let dropArea = document.getElementById('drop-area');
    //let multipleAdsButton = document.getElementById('multiple-ads-button');

    let uploadProgress = [];
    let progressBar = document.getElementById('progress-bar');

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, preventDefaults, false)
    });

    function preventDefaults (e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, highlight, false)
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, unhighlight, false)
    });

    function highlight(e) {
        dropArea.classList.add('highlight');
    }

    function unhighlight(e) {
        dropArea.classList.remove('highlight')
    }

    dropArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        let dt = e.dataTransfer;
        let files = dt.files;
        handleFiles(files)
    }

    function handleFiles(files) {
        files = [...files];
        initializeProgress(files.length);
        files.forEach(uploadFile);
        files.forEach(previewFile);
    }

    function uploadFile(file, i) {



        var url ='/savePhoto';
        var xhr = new XMLHttpRequest();
        var formData = new FormData();
        xhr.open('POST', url, true);

        xhr.upload.addEventListener("progress", function(e) {
            updateProgress(i, (e.loaded * 100.0 / e.total) || 100)

        });
        xhr.addEventListener('readystatechange', function(e) {
            if (xhr.readyState === 4 && xhr.status === 200) {
            }
            else if (xhr.readyState === 4 && xhr.status !== 200) {
            }
        });
        formData.append('file', file);
        xhr.send(formData);
    }

    function previewFile(file) {
        let reader = new FileReader();
        let counter = 0;
        reader.readAsDataURL(file);
        reader.onloadend = function() {
            let img = document.createElement('img');
            img.src = reader.result;
            document.getElementById('gallery').appendChild(img);

            /**/
            //added for rendering at table
            let imgRend = document.createElement('img');
            imgRend.src = reader.result;
            let renderingZone = document.getElementById('attachments-container');
                    //renderingZone.classList.add('hide');
            renderingZone.appendChild(imgRend);

            //end of added for rendering at table


            counter ++;
            dropArea.classList.add('move-up');
            //multipleAdsButton.classList.add('hidden');
        }
    }

    function initializeProgress(numFiles) {
        progressBar.value = 0;
        uploadProgress = [];
        for(let i = numFiles; i > 0; i--) {
            uploadProgress.push(0);
        }
    }

    function updateProgress(fileNumber, percent) {

        uploadProgress[fileNumber] = percent;

        let total = uploadProgress.reduce((tot, curr) => tot + curr, 0) / uploadProgress.length;

        for (let i = 0; i < 101; i++) {

            setTimeout(function () {
                progressBar.value++;
            }, 4 * (i + 1));
        }

    }

        setTimeout(function(){
            for (var i = 101; i < 201; i ++)
            {

                setTimeout(function () {
                    progressBar.value --;
                },2*(i+1));
            }
        },1000);

    let gallery = document.getElementById('gallery');

    function clearDropZone(object) {
        while (object.firstChild) {
            object.removeChild(object.firstChild);
        }
        progressBar.value = 0;
        dropArea.classList.remove('move-down');
    }

    function clearProgressBar() {
        $('#progress-bar').removeClass('.progress-bar span:last-child');
        $('.progress-bar span:last-child').addClass('grey');
        $('.progress-bar').addClass('grey')
    }
</script>


<script>
    requestApp = angular.module("requestApp", []);

    requestApp.controller("requestHandlerController", requestHandlerController);

    function requestHandlerController($scope) {
             if ($scope.dataTable == null){$scope.dataTable = [];}
             $scope.nextRequest = {};
             $scope.nextRequest.message = "";
             $scope.nextRequest.avatarSrc = 'img/smithc.jpg';

            $scope.pushRow = function () {
                //debugger;
                //console.log('pushRow()');

                $scope.prepareSrc();
                $scope.dataTable.push($scope.nextRequest);
                $scope.dataTable = $scope.dataTable.reverse();

                let tempName = $scope.dataTable[0].name;
                let tempPhone = $scope.dataTable[0].phone;

                $scope.$apply();

                $scope.nextRequest = {};
                $scope.nextRequest.name = tempName;
                $scope.nextRequest.phone = tempPhone;
                $scope.nextRequest.message = "";
                $scope.nextRequest.avatarSrc = 'img/smithc.jpg';

                /**/
                $scope.nextRequest.index = $scope.dataTable.length + 1;
                let renderingZone = document.getElementsByClassName('attachments-container-');
                renderingZone.classList.remove('hide');
            };

            $scope.prepareSrc = function () {
                debugger;
                let targetChar = "c";
                if ($('.d').prop('checked')) {targetChar = "d";}
                else
                if ($('.b').prop('checked')) {targetChar = "b";}
                else {targetChar = "c";}

                let res = $scope.nextRequest.avatarSrc.substring(0,9) + targetChar + $scope.nextRequest.avatarSrc.substring(10,14);
                $scope.nextRequest.avatarSrc = res;
            };

            $('#send-button').on('click', $scope.pushRow);

            $('.d').on('mouseup', function () {
                $('.default-ava').prop('checked', false);
                $('.b').prop('checked', false);
            });

            $('.b').on('mouseup', function () {
                $('.default-ava').prop('checked', false);
                $('.d').prop('checked', false);
            });

        $('.default-ava').on('mouseup', function () {
            if (!$('.d').prop('checked')) {$('.d').prop('checked', true);}
            $('.b').prop('checked', false);
            $('.d').prop('checked', false);
        });
        }
</script>
</html>
